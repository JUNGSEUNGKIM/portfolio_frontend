# ğŸš€ Backend CI/CD êµ¬ì¶• ë¬¸ì„œ

## ğŸ“ í”„ë¡œì íŠ¸ í´ë” êµ¬ì¡°
```
/ (repo root)
â”œâ”€â”€ backend/                  # ë°°í¬ìš© NestJS ë°±ì—”ë“œ
â”‚   â”œâ”€â”€ Dockerfile           # âœ… ë°˜ë“œì‹œ í¬í•¨
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ src/
â”œâ”€â”€ frontend/                # ë°°í¬ìš© React í”„ë¡ íŠ¸ì—”ë“œ
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ src/
â”œâ”€â”€ docker-compose.yml       # ì „ì²´ ì„œë¹„ìŠ¤ ì •ì˜
â”œâ”€â”€ .env                     # ì„œë²„ ì „ìš©, Gitì—ëŠ” í¬í•¨ âŒ
â””â”€â”€ .github/workflows/
    â””â”€â”€ deploy-backend.yml   # GitHub Actions ë°°í¬ ìë™í™”
```

## âš™ï¸ ë‹¨ì¼ Docker vs Docker Compose ì°¨ì´

| í•­ëª© | ë‹¨ì¼ Docker run ë°©ì‹ | Docker Compose ë°©ì‹ |
|------|-----------------------|----------------------|
| í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬ | --env-file ë˜ëŠ” ì§ì ‘ ì§€ì • | env_fileë¡œ ê¹”ë”í•˜ê²Œ ë¶„ë¦¬ |
| ì„œë¹„ìŠ¤ ìˆ˜ | í•˜ë‚˜ (ë‹¨ì¼ ì»¨í…Œì´ë„ˆ) | ì—¬ëŸ¬ ê°œ (DB, MinIO, Backend ë“±) |
| í™•ì¥ì„± | ì œí•œì  | ìœ ì—°í•¨, ë©€í‹° í™˜ê²½ êµ¬ì„± ê°€ëŠ¥ |
| ìœ ì§€ë³´ìˆ˜ | ìˆ˜ë™, ì»¤ë§¨ë“œ ê¸¸ì–´ì§ | ì„ ì–¸í˜• ê´€ë¦¬, ìœ ì§€ë³´ìˆ˜ í¸ë¦¬ |
| ìš´ì˜ ì í•©ë„ | ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸/ê°œë°œìš© | ì‹¤ì „ ìš´ì˜ í™˜ê²½ ì í•© |

## ğŸ“¦ deploy-backend.yml ì„¤ëª…
```yaml
name: ğŸš€ Deploy Backend

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“… Checkout code
        uses: actions/checkout@v3

      - name: ğŸ”§ Node.js ì„¤ì¹˜ (version ê³ ì •)
        uses: actions/setup-node@v3
        with:
          node-version: 22

      - name: ğŸ” íˆ´ ë²„ì „ í™•ì¸
        run: |
          echo "ğŸ§° ë²„ì „ ì²´í¬ ì‹œì‘"
          node -v
          npm -v
          docker -v
          git --version
          echo "âœ… íˆ´ ì²´í¬ ì™„ë£Œ"

      - name: ğŸ›£ Set up Docker
        uses: docker/setup-buildx-action@v2

      - name: ğŸ” Docker Hub Login
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: ğŸ› ï¸ Build and Push Backend Docker Image
        run: |
          docker build -t ${{ secrets.DOCKER_USERNAME }}/portfolio-backend:latest .
          docker push ${{ secrets.DOCKER_USERNAME }}/portfolio-backend:latest

      - name: ğŸ§‘â€ğŸ’» SSH into server and deploy
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.SERVER_IP }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd /opt/home-server
            docker compose pull backend
            docker compose up -d backend
```

## ğŸ§  run: vs uses: ì°¨ì´ ì •ë¦¬
| í•­ëª© | uses: | run: |
|------|-------|------|
| ì—­í•  | GitHub Action í”ŒëŸ¬ê·¸ì¸ ì‚¬ìš© | ì§ì ‘ ì…¸ ëª…ë ¹ ì‹¤í–‰ |
| ìœ„ì¹˜ | GitHubì—ì„œ ì •ì˜ëœ ì•¡ì…˜ ì‚¬ìš© | YAML ë‚´ ì§ì ‘ ì •ì˜ |
| ì‚¬ìš© ì˜ˆ | checkout, login-action ë“± | docker build, npm run build ë“± |
| ì‹¤í–‰ ìœ„ì¹˜ | GitHubì˜ ê°€ìƒ ë¨¸ì‹  | ë™ì¼ (ê°€ìƒ Ubuntu ë¨¸ì‹ ) |

## ğŸ³ Dockerfile ì•ˆì—ì„œ npm installê³¼ buildë¥¼ í•˜ëŠ” ì´ìœ 
CI/CDì—ì„œ ë”°ë¡œ npm install í•˜ì§€ ì•ŠìŒ â†’ ì´ìœ ëŠ”?
â†’ `docker build` ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë  ë•Œ Dockerfile ë‚´ë¶€ì—ì„œ ì„¤ì¹˜ì™€ ë¹Œë“œë¥¼ ëª¨ë‘ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸!

Dockerfile ì˜ˆì‹œ:
```dockerfile
FROM node:22
WORKDIR /app
COPY package*.json ./
RUN npm install --production
COPY . .
RUN npm run build
CMD ["node", "dist/main"]
```
âœ… ë”°ë¼ì„œ GitHub Actionsì—ì„œëŠ” `docker build`ë§Œ ì‹¤í–‰í•˜ë©´ ë¨.

## ğŸ” GitHub Secrets í•„ìš” ëª©ë¡
| ì´ë¦„ | ìš©ë„ |
|------|------|
| DOCKER_USERNAME | Docker Hub ID |
| DOCKER_PASSWORD | Docker Hub Access Token |
| SERVER_IP | ë°°í¬ ì„œë²„ IP |
| SERVER_USER | SSH ì ‘ì† ìœ ì €ëª… |
| SSH_PRIVATE_KEY | SSH ë¹„ê³µê°œ í‚¤ (base64 ì•„ë‹˜, ì›ë³¸ í…ìŠ¤íŠ¸)

## ğŸ“ ê¸°íƒ€ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [x] `.env`ëŠ” Gitì— í¬í•¨ âŒ (.dockerignoreì—ë„ ì¶”ê°€)
- [x] Dockerfileì€ ë°˜ë“œì‹œ ì½”ë“œì— í¬í•¨ âœ…
- [x] `.dockerignore` êµ¬ì„±:
```
node_modules
dist
.env*
.git
*.log
```
- [x] CIì—ì„œ ì‚¬ìš©í•˜ëŠ” node ë²„ì „ì€ `setup-node`ë¡œ ê³ ì •
- [x] `env_file: - .env`ëŠ” ì„œë²„ docker-compose.ymlì—ì„œ ì ìš©ë¨

---

