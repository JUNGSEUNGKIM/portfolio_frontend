# ğŸš€ í”„ë¡ íŠ¸ì—”ë“œ CI/CD ìë™ ë°°í¬ ê°€ì´ë“œ

## ì™œ í”„ë¡ íŠ¸ëŠ” NGINXê³¼ í•¨ê»˜ ì´ë¯¸ì§€ë¡œ ë§Œë“¤ì–´ì•¼ í• ê¹Œ?

í”„ë¡ íŠ¸ì—”ë“œ(Vite + React)ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì •ì  íŒŒì¼(HTML, JS, CSS)ì„ ìƒì„±í•©ë‹ˆë‹¤.\
ì´ ì •ì  íŒŒì¼ì€ ì›¹ ë¸Œë¼ìš°ì €ì— ì „ë‹¬ë˜ê¸°ë§Œ í•˜ë©´ ë˜ë‹ˆ, ì‹¤ì œ ì‹¤í–‰ í™˜ê²½ì—ì„œëŠ” ì„œë²„ê°€ í•„ìš” ì—†ìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ:

- **ì •ì  íŒŒì¼ì„ ì§ì ‘ ì „ë‹¬í•´ì¤„ ì„œë²„ê°€ í•„ìš”**
- **í”„ë¡œí‚¤, ìºì‹œ, SPA ë¦¬ë‹¤ì´ë ‰ì…˜ ì²˜ë¦¬ë¥¼ ìœ„í•´ì„œ ì „ë¬¸ ì›¹ì„œë²„ ì„¤ì • í•„ìš”**

ğŸ“Œ ê·¸ëŸ¬ë©´ì„œ ì €í¬ëŠ” **NGINXë¥¼ í¬í•¨í•œ Docker ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì–´**,\
í”„ë¡ íŠ¸ì˜ `dist` ê²°ê³¼ë¬¼ì„ `/usr/share/nginx/html`ì— ë³µì‚¬í•œ ë’¤,\
NGINXê°€ ì´ë¥¼ ì„œë¹„í•˜ë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤.

> ì¦‰, **í”„ë¡ íŠ¸ + NGINX**ë¥¼ ë¬´ê¸°ëœ í•˜ë‚˜ì˜ ì™„ì „ ì´ë¯¸ì§€ê°€ ì‹¤ì œë¡œ ë°°í¬ë©ë‹ˆë‹¤.

---

## íŒŒì¼ êµ¬ì¡° ìš”ì•½

```
bash
/opt/home-server/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ nginx.conf
â”‚   â”œâ”€â”€ dist/
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ ...
â””â”€â”€ .github/
    â””â”€â”€ workflows/
        â””â”€â”€ deploy-frontend.yml
```

---

## âš™ï¸ `frontend/Dockerfile`

```
FROM node:20-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

FROM nginx:stable-alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

---

## ğŸ§¾ `frontend/nginx.conf`

```
server {
  listen 80;
  server_name localhost;

  location / {
    root /usr/share/nginx/html;
    index index.html;
    try_files $uri $uri/ /index.html;
  }
}
```

---

## ğŸ“¦ `.dockerignore`

```
node_modules
dist
*.log
.dockerignore
```

---

## ğŸ³ `docker-compose.yml` (frontend ë§Œ ë“±ë¡)

```
services:
  frontend:
    image: jskim54285284/portfolio-frontend:latest
    container_name: frontend
    ports:
      - "80:80"
    restart: always
    networks:
      - app-net

networks:
  app-net:
    driver: bridge
```

---

## ğŸ” GitHub Actions `deploy-frontend.yml`

```
name: ğŸš€ Deploy Frontend

on:
  push:
    branches:
      - main
    paths:
      - 'frontend/**'

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    env:
      IMAGE_NAME: portfolio-frontend

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v3

      - name: ğŸ³ Set up Docker
        uses: docker/setup-buildx-action@v2

      - name: ğŸ” Docker Hub Login
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: ğŸ“‚ Build and Push Frontend Docker Image
        run: |
          docker build -t ${{ secrets.DOCKER_USERNAME }}/${{ env.IMAGE_NAME }}:latest ./frontend
          docker push ${{ secrets.DOCKER_USERNAME }}/${{ env.IMAGE_NAME }}:latest

      - name: ğŸ§‘â€ğŸ’¼ SSH into server and deploy
        uses: appleboy/ssh-action@v0.1.10
        with:
          host: ${{ secrets.SERVER_IP }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
              cd /opt/home-server

              echo "ğŸ›‘ frontend ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ë° ì œê±°"
              docker compose stop frontend || true
              docker compose rm -f frontend || true

              echo "ğŸ—‘ï¸ ê¸°ì¡´ frontend ì´ë¯¸ì§€ ì‚­ì œ"
              docker rmi -f ${{ secrets.DOCKER_USERNAME }}/portfolio-frontend:latest || true

              echo "ğŸ“¥ ìƒˆ ì´ë¯¸ì§€ pull"
              docker compose pull frontend

              echo "ğŸš€ ì»¨í…Œì´ë„ˆ ì¬ì‹¤í–‰"
              docker compose up -d frontend --remove-orphans
```

---

## ğŸ” GitHub Secrets ì„¤ì •

| Key                   | Description                    |
| --------------------- | ------------------------------ |
| `DOCKER_USERNAME`     | Docker Hub ê³„ì • ID               |
| `DOCKER_PASSWORD`     | Docker Hub ë¹„ë°€ë²ˆí˜¸ ë˜ëŠ” token       |
| `SERVER_IP`           | ë°°í¬ ëŒ€ìƒ ì„œë²„ IP                    |
| `SERVER_USER`         | SSH ìœ ì €ëª… (ex. ec2-user, ubuntu) |
| `SSH_PRIVATE_KEY`     | SSH ê°€ìƒ í‚¤ id\_rsa ë‚´ìš©            |
| `SSH_PORT` (optional) | 22ê°€ ê¸°ë³¸, ë‹¤ë¥¸ í¬íŠ¸ì´ë©´ ì§€ì •             |

---

## âœ… ì „ì²´ í†µí•© í”„ë¡œì„¸ìŠ¤

1. `frontend/` ë””ë ‰í† ë¦¬ì˜ ì½”ë“œ ìˆ˜ì • í›„ `main` ë¸Œëœì¹˜ì— push
2. GitHub Actions íŠ¸ë¦¬ê°€ ë°œë™
3. í”„ë¡ íŠ¸ ë¹Œë“œ + NGINX í¬í•¨ ì´ë¯¸ì§€ ìƒì„±
4. Docker Hubì— push
5. ì„œë²„ì— SSH ì ‘ì†
6. ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¤‘ì§€ + ì´ë¯¸ì§€ ì‚­ì œ + ìƒˆ pull
7. `docker compose up -d frontend`ë¡œ ì¬ì‹¤í–‰

---

## ğŸ§  í–¥í›„ ê°œì¡° í™€ì§€

- `watchtower` ì‚¬ìš©ìœ¼ë¡œ GitHub Actionsì—ì„œ SSH ë‹¨ê³„ ìƒëµ ê°€ëŠ¥
- í”„ë¡ íŠ¸ + ë°±ì—”ë“œ í†µí•© ëª¨ë‹ˆí„°ë§ / Slack ì•Œë¦¼ ê°±ì‹ 
- `nginx.conf` ê³ ë„í™” (gzip, cache, https ë“±)



