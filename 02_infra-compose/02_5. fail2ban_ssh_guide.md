# ğŸ›¡ï¸ fail2ban ì„¤ì • ê°€ì´ë“œ + SSH ë³´ì•ˆ ì„¤ì •

---

## âœ… ëª©ì 
- ë°˜ë³µì ì¸ ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œë„(IP) ìë™ ì°¨ë‹¨
- ì›Œë“œí”„ë ˆìŠ¤ ë´‡/ë¹„ì •ìƒ ì ‘ê·¼ì ì°¨ë‹¨
- SSH ë³´ì•ˆ ê°•í™” (í‚¤ ì¸ì¦ë§Œ í—ˆìš©)

---

## ğŸ“‚ 1. fail2ban ì„¤ì¹˜

```bash
sudo apt update
sudo apt install fail2ban -y
```

---

## âš™ï¸ 2. jail.local ì„¤ì •

ğŸ“„ íŒŒì¼ ê²½ë¡œ: `/etc/fail2ban/jail.local`

```ini
[DEFAULT]
banaction = nftables
banaction_allports = nftables[type=allports]
backend = systemd

[sshd]
enabled = true
port = 22               # SSH í¬íŠ¸ (ë³€ê²½ ì‹œ ë°˜ì˜)
filter = sshd
logpath = %(sshd_log)s
maxretry = 5
bantime = 600
findtime = 600

[nginx-bot]
enabled = true
port = http,https
filter = nginx-bot
logpath = /opt/home-server/nginx/logs/access.log
maxretry = 3
findtime = 60
bantime = 86400         # 1ì¼ ì°¨ë‹¨
```

---

## ğŸ” 3. nginx-bot í•„í„° ë§Œë“¤ê¸°

ğŸ“„ ê²½ë¡œ: `/etc/fail2ban/filter.d/nginx-bot.conf`

```ini
[Definition]
failregex = <HOST> -.*"(GET|POST).*wp-login.php
            <HOST> -.*"(GET|POST) /(ws/objectManager|\.env|admin).* HTTP/1.1"
ignoreregex =
```

> ê³µê²© ê°€ëŠ¥ì„±ì´ ë†’ì€ ê²½ë¡œ ìš”ì²­ì„ ê°ì§€í•˜ê³  ì°¨ë‹¨

---

## âœ… 4. ì ìš© ë° í™•ì¸

```bash
sudo systemctl restart fail2ban
sudo fail2ban-client status
sudo fail2ban-client status sshd
sudo fail2ban-client status nginx-bot
```

---

## ğŸ›¡ï¸ 5. SSH ë³´ì•ˆ ì„¤ì • (í‚¤ ì¸ì¦ë§Œ í—ˆìš©)

### ğŸ”§ `/etc/ssh/sshd_config` ìˆ˜ì •

```ini
Port 2222                     # ê¸°ë³¸ í¬íŠ¸ëŠ” 22 â†’ ë³€ê²½ ê¶Œì¥
PermitRootLogin no            # ë£¨íŠ¸ ë¡œê·¸ì¸ ì°¨ë‹¨
PasswordAuthentication no     # ë¹„ë°€ë²ˆí˜¸ ë¡œê·¸ì¸ ì°¨ë‹¨ (í‚¤ë§Œ í—ˆìš©)
AllowUsers arami              # ì ‘ì† í—ˆìš© ì‚¬ìš©ì ì œí•œ
```

> ìˆ˜ì • í›„ ë°˜ë“œì‹œ SSH í‚¤ê°€ ë“±ë¡ë˜ì–´ ìˆì–´ì•¼ í•¨!

### ğŸ“¥ í‚¤ ë“±ë¡ í™•ì¸

```bash
cat ~/.ssh/authorized_keys
```

ë“±ë¡ì´ ì•ˆë˜ì–´ ìˆë‹¤ë©´ ë¡œì»¬ì—ì„œ ìƒì„± í›„ ê³µê°œí‚¤ ë“±ë¡:

```bash
ssh-keygen -t ed25519 -C "user@home-server"
ssh-copy-id -p 2222 user@ì„œë²„IP
```

### ğŸ” SSH ì ìš©

```bash
sudo systemctl restart ssh
```

---

## ğŸ” ì£¼ì˜ ì‚¬í•­

- SSH í¬íŠ¸ ë°”ê¿¨ë‹¤ë©´ ë°©í™”ë²½ í—ˆìš© í•„ìš”:
```bash
sudo ufw allow 2222/tcp
```

- fail2banì€ systemd ë°±ì—”ë“œì™€ nftables ê¸°ë°˜ìœ¼ë¡œ ë™ì‘ ì¤‘

---

_Last Updated: 2025-04-18 05:06:49_
